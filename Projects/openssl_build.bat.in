echo on
set CMAKE_SIZEOF_VOID_P=@CMAKE_SIZEOF_VOID_P@
set OPENSSL_INSTALL_PATH=@OPENSSL_INSTALL_PATH@
set VCVAR_PATH=@VCVAR_PATH@
set NASM_PATH=@NASM_PATH@
set STRAWBERRY_PERL_PATH=@STRAWBERRY_PERL_PATH@
set IMPORT_PROJECT_STATIC_CRT="@IMPORT_PROJECT_STATIC_CRT@"
set ZLIB_INCLUDE_DIR=@ZLIB_INCLUDE_DIR@
set ZLIB_LIBRARY_DIR=@ZLIB_LIBRARY_DIR@

set PATH=%NASM_PATH%;%PATH%
set PATH=%STRAWBERRY_PERL_PATH%/perl/bin;%PATH%
set PATH=%STRAWBERRY_PERL_PATH%/perl/site/bin;%PATH%
set PATH=%STRAWBERRY_PERL_PATH%/c/bin;%PATH%

call "%VCVAR_PATH%"

set OPENSSL_CONFIGURE_PARAMA=
if %CMAKE_SIZEOF_VOID_P% EQU 8 (
    set OPENSSL_CONFIGURE_PARAMA=%OPENSSL_CONFIGURE_PARAMA% VC-WIN64A
) else (
    set OPENSSL_CONFIGURE_PARAMA=%OPENSSL_CONFIGURE_PARAMA% VC-WIN32
)

set OPENSSL_CONFIGURE_PARAMA=%OPENSSL_CONFIGURE_PARAMA% --prefix=%OPENSSL_INSTALL_PATH% --openssldir=%OPENSSL_INSTALL_PATH%\ssl

if %IMPORT_PROJECT_STATIC_CRT% == "TRUE" (
    set OPENSSL_CONFIGURE_PARAMA=%OPENSSL_CONFIGURE_PARAMA% -static no-pic no-shared no-threads
) 

if defined ZLIB_INCLUDE_DIR  (
    set OPENSSL_CONFIGURE_PARAMA=%OPENSSL_CONFIGURE_PARAMA% --with-zlib-lib=%ZLIB_LIBRARY_DIR% --with-zlib-include=%ZLIB_INCLUDE_DIR%
) 

perl Configure %OPENSSL_CONFIGURE_PARAMA%
:: 编译
nmake -f makefile
:: 测试(可选)
::nmake test
:: 安装
nmake install